# 5.1 SP2 APS分解分配

## APDB

* apdb支持读取和缓存本服务域的平台域
* apdb新增读取平台域的备份平台域信息
* 支持根据bmc下发的备份配置（自动、手动、是否启用备平台）实时更新当前的主备状态

## 地址列表

* APS返回给终端的地址中，包含备份APS的地址
* APS地址列表中，终端所属平台域的APS永远位于第一位
* 若APS为备份APS，则报给终端的服务器列表均为备份平台域的服务器列表

## 登陆

### 手动模式

* 若当前平台域设置了备份平台域，且备份规则已生效，则所有登录到本平台域的终端都被NACK
* 若当前平台域正常运行，且登录到APS的终端所属平台域不同，则判定本平台域是否为该终端所属平台域的备份平台域，若否，则直接NACK，若是，则判断备份规则是否生效，若生效，则允许登录，否则NACK

### 自动模式

* 只要本APS所在平台域是当前终端的主平台域或备份平台域，就允许终端登录


## 已知问题

* 若终端第一次登陆此平台域（即终端尚未缓存备份平台域的APS地址），且主平台域被手动设置为了不可用，平台会回复NACK给终端，此时终端拿不到备用平台域的APS信息，需要终端自行配置备份APS的地址。