# 5.1 SP2 CSS分解分配

## ZK

* ZK上报的MCU信息里新增平台域moid

## MCU

* CSS允许同时连接多个平台域的MCU（都会上报到同一个zk里）
* MCU按平台域分组，不可混用

## License

* CSS需要同时感知不同平台域的license信息 （DR02.0007）
* 跨域恢复会议时，占用备份域的license（DR02.0007）

## UPU

* 需要支持通过upu查询本平台域的nu信息
* 所有平台域的会议信息都上报到CSS所在的upu中

## AP

* 需要支持获取多个平台域的license信息
* 需要读取平台域的备份域、是否自动备份、是否开启手动备份的信息

## 创会

* 终端创会
  * nu在创会信息中会携带终端登录的平台域moid，css创会时根据此moid决定会议创在哪个平台域
  * 如终端创会所携带的平台域挂了，直接拒绝，不再查找备份平台域
* 会管创会及恢复会议
  * 自动备份，如果终端所属平台域下1.无mcu，2.通过upu查询不到nu，则创到备份平台域
  * 手动模式，如果开启了手动备份，则不管原平台域有无mcu和nu，都开到备份平台域
* 如果平台域恢复了，已开在备份平台域的会议不重新创建
* 不考虑连环配置备份的场景（如：B备A，C备B），需工程限制或界面限制 @池传钦
* 如果备份平台域资源不足或license点数已满。则恢复失败，等待直到资源上线或有会议结束

## 终端

报给终端的会议列表等地方按用户域匹配会议，不管会议实际开在那个平台域上

## 网管

所有外部服务器的连接信息上报给CSS所在平台域的网管

## Redis

confex里需要增加会议所属平台域moid字段，计算license时需要用到

## 其他

CSS需要感知当前是否为跨域建云模式

## 会议备份

手动模式

* 主切备时，已召开的会议备份到备份平台域（DR02.0005.07）
* 备切主时，结束所有备份的会议（DR02.0005.08）

自动模式

* 主切备，已召开的会议备份到备份平台域 （DR02.0005.03）
  * mcu挂了触发会议恢复，如果此时平台域下有其他mcu，则恢复到其他mcu上
  * 如果平台域下没有其他mcu，则查询nu是否存在，如果nu存在，则仍尝试在本平台域恢复
  * 如果nu不存在，则恢复到备份平台域
* 备切主，已召开的会议仍然保留在备份平台域（DR02.0005.04）
